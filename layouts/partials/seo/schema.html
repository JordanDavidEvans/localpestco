{{- $env := getenv "HUGO_ENV" | default "production" -}}
{{- $base := .Site.Params.productionBaseURL | default .Site.BaseURL -}}
{{- $schemas := slice -}}

{{- $org := dict "@type" "Organization" "name" .Site.Title "url" $base -}}
{{- with .Site.Params.logo }}{{ $org = merge $org (dict "logo" (absURL .)) }}{{ end -}}
{{- $schemas = $schemas | append $org -}}

{{- /* LocalBusiness schema */ -}}
{{- $areas := slice "Kingscliff" "Casuarina" "Cabarita" "Pottsville" "Murwillumbah" "Chinderah" "Cudgen" "Fingal Head" "Banora Point" "Terranora" "Tweed Heads" -}}
{{- $sameAs := slice -}}
{{- with .Site.Params.social.facebook }}{{ $sameAs = $sameAs | append . }}{{ end -}}
{{- with .Site.Params.social.twitter }}{{ $sameAs = $sameAs | append . }}{{ end -}}
{{- $lb := dict "@type" "LocalBusiness" "@id" (printf "%s#localbusiness" $base) "name" .Site.Title "url" $base "telephone" "0405 508 035" "areaServed" $areas "sameAs" $sameAs "address" (dict "@type" "PostalAddress" "addressLocality" "Kingscliff" "addressRegion" "NSW" "addressCountry" "AU") -}}
{{- $hours := slice (dict "@type" "OpeningHoursSpecification" "dayOfWeek" "Monday" "opens" "08:00" "closes" "17:00") (dict "@type" "OpeningHoursSpecification" "dayOfWeek" "Tuesday" "opens" "08:00" "closes" "17:00") (dict "@type" "OpeningHoursSpecification" "dayOfWeek" "Wednesday" "opens" "08:00" "closes" "17:00") (dict "@type" "OpeningHoursSpecification" "dayOfWeek" "Thursday" "opens" "08:00" "closes" "17:00") (dict "@type" "OpeningHoursSpecification" "dayOfWeek" "Friday" "opens" "08:00" "closes" "17:00") -}}
{{- $lb = merge $lb (dict "openingHoursSpecification" $hours) -}}
{{- with .Site.Params.logo }}{{ $lb = merge $lb (dict "image" (absURL .)) }}{{ end -}}
{{- $schemas = $schemas | append $lb -}}

{{- $website := dict "@type" "WebSite" "name" .Site.Title "url" $base -}}
{{- with .Site.Params.search.url -}}
  {{- $website = merge $website (dict "potentialAction" (dict "@type" "SearchAction" "target" (printf "%s?q={search_term_string}" .) "query-input" "required name=search_term_string")) -}}
{{- end -}}
{{- $schemas = $schemas | append $website -}}

{{- /* Breadcrumbs */ -}}
{{- $crumbs := slice -}}
{{- $pos := 1 -}}
{{- $section := .CurrentSection -}}
{{- if $section -}}
  {{- range (append ($section.Ancestors.Reverse) (slice $section)) -}}
    {{- $crumbs = $crumbs | append (dict "@type" "ListItem" "position" $pos "name" .Title "item" (replace .Permalink .Site.BaseURL $base)) -}}
    {{- $pos = add $pos 1 -}}
  {{- end -}}
{{- end -}}
{{- if .IsPage -}}
  {{- $crumbs = $crumbs | append (dict "@type" "ListItem" "position" $pos "name" .Title "item" (replace .Permalink .Site.BaseURL $base)) -}}
{{- end -}}
{{- if gt (len $crumbs) 0 -}}
  {{- $schemas = $schemas | append (dict "@type" "BreadcrumbList" "itemListElement" $crumbs) -}}
{{- end -}}

{{- if .Params.faq -}}
  {{- $faqitems := slice -}}
  {{- range .Params.faq -}}
    {{- $faqitems = $faqitems | append (dict "@type" "Question" "name" .question "acceptedAnswer" (dict "@type" "Answer" "text" .answer)) -}}
  {{- end -}}
  {{- $schemas = $schemas | append (dict "@type" "FAQPage" "mainEntity" $faqitems) -}}
{{- end -}}

{{- with .Params.service -}}
  {{- $svc := merge (dict "@type" "Service") . -}}
  {{- $schemas = $schemas | append $svc -}}
{{- end -}}

{{- if .IsPage -}}
  {{- $ptype := "WebPage" -}}
  {{- if in (slice "posts" "blog") .Section }}{{ $ptype = "Article" }}{{ end -}}
  {{- $page := dict "@type" $ptype "headline" .Title "url" (replace .Permalink .Site.BaseURL $base) "datePublished" (.PublishDate | time.Format "2006-01-02") "dateModified" (.Lastmod | time.Format "2006-01-02") -}}
  {{- with .Params.author }}{{ $page = merge $page (dict "author" (dict "@type" "Person" "name" .)) }}{{ end -}}
  {{- with (or .Params.images (slice)) }}{{ $page = merge $page (dict "image" (apply (first 1 .) "absURL" ".")) }}{{ end -}}
  {{- with .Params.schema }}{{ $page = merge $page . }}{{ end -}}
  {{- $schemas = $schemas | append $page -}}
{{- end -}}

<script type="application/ld+json">
{{ $schemas | jsonify }}
</script>
