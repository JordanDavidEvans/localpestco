{{- $env := getenv "HUGO_ENV" | default "production" -}}
{{- $prod := .Site.Params.productionBaseURL | default .Site.BaseURL -}}
{{- $siteTitle := .Site.Title -}}
{{- $title := .Params.title | default .Title -}}
{{- if not (in (lower $title) (lower $siteTitle)) -}}
  {{- $title = printf "%s | %s" $title $siteTitle -}}
{{- end -}}
{{- with .Site.Params.titleSuffix -}}
  {{- $title = printf "%s%s" $title . -}}
{{- end -}}
<title>{{ $title }}</title>
{{- if not .Title }}{{ warnf "Missing title for %s" .RelPermalink }}{{ end -}}

{{- $desc := .Params.meta_desc | default .Params.description | default (.Summary | plainify) | default .Site.Params.description -}}
{{- if and (not .Params.meta_desc) (not .Params.description) }}{{ warnf "Missing meta description for %s" .RelPermalink }}{{ end -}}
{{- if $desc }}<meta name="description" content="{{ $desc | plainify | htmlEscape }}">{{ end -}}

{{- $robots := "index,follow" -}}
{{- if .Params.noindex }}{{ $robots = "noindex,follow" }}{{ end -}}
{{- with .Params.robots }}{{ $robots = . }}{{ end -}}
<meta name="robots" content="{{ $robots }}">

{{- $canon := .Permalink -}}
{{- with .Params.canonical }}{{ $canon = . | absURL }}{{ end -}}
{{- if ne $env "production" }}{{ $canon = replace $canon .Site.BaseURL $prod }}{{ end -}}
<link rel="canonical" href="{{ $canon }}">

{{- if .IsPage }}<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">{{ end -}}

{{- with .OutputFormats.Get "RSS" -}}
<link rel="alternate" type="application/rss+xml" href="{{ .RelPermalink }}" title="{{ $.Site.Title }}"/>
{{- end -}}

<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:title" content="{{ $title }}">
{{- if $desc }}<meta property="og:description" content="{{ $desc }}">{{ end }}
<meta property="og:url" content="{{ $canon }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
{{- $img := .Params.social_image | default (index .Params.images 0) -}}
{{- with $img }}<meta property="og:image" content="{{ . | absURL }}">{{ end }}

{{- $card := "summary" -}}
{{- with $img }}{{ $card = "summary_large_image" }}{{ end -}}
<meta name="twitter:card" content="{{ $card }}">
{{- with .Site.Params.social.twitter }}<meta name="twitter:site" content="{{ . }}">{{ end }}
<meta name="twitter:title" content="{{ $title }}">
{{- if $desc }}<meta name="twitter:description" content="{{ $desc }}">{{ end }}
{{- with $img }}<meta name="twitter:image" content="{{ . | absURL }}">{{ end }}

{{- if .IsTranslated -}}
{{- range .Translations -}}
<link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}" />
{{- end -}}
<link rel="alternate" hreflang="x-default" href="{{ .Permalink }}" />
{{- end -}}
